import numpy as np
import pytest as pt
from chemreps.utils.molecule import Molecule
import chemreps.bag_of_bonds as bob


def test_bag_maker():
    bags_true = {'C': [], 'CC': [], 'CH': [], 'H': [],
                 'HH': [], 'O': [], 'OO': [], 'OC': [], 'OH': []}
    bags, bag_sizes = bob.bag_maker('data/sdf/')
    assert bags == bags_true


def test_bag_of_bonds():
    bobs_true = [36.84375, 36.84375, 36.84375, 36.84375, 0.00000, 0.00000, 0.00000, 0.00000, 36.00000, 36.00000, 36.00000, 20.78125, 20.78125, 13.60156, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 9.67188, 9.67188, 9.67188, 9.67188, 9.67188, 9.67188, 9.67188, 9.67188, 9.67188, 9.67188, 5.55078, 5.55078, 5.55078, 5.55078, 5.09766, 5.09766, 5.09766, 5.09766, 4.23828, 4.23828, 3.94922, 3.94531, 3.75781, 3.75781, 3.75781, 3.75781, 3.70312, 3.70312, 2.84180, 2.84180, 2.74805, 2.74805, 2.62109, 2.61914, 2.38867, 2.38867, 2.06250, 2.06250, 1.85254, 1.85254, 0.00000, 0.00000, 0.00000, 0.50000, 0.50000, 0.50000, 0.50000, 0.50000, 0.50000, 0.50000,
                 0.50000, 0.50000, 0.50000, 0.00000, 1.25488, 1.25488, 1.14062, 1.14062, 1.14062, 1.14062, 1.12012, 1.12012, 0.97510, 0.97510, 0.80615, 0.80615, 0.68896, 0.65820, 0.65820, 0.61328, 0.61328, 0.61182, 0.61182, 0.59229, 0.59229, 0.55908, 0.55908, 0.54883, 0.54883, 0.53271, 0.53271, 0.51807, 0.51807, 0.45312, 0.45190, 0.45190, 0.39575, 0.37842, 0.37842, 0.37793, 0.37793, 0.37427, 0.37427, 0.31958, 0.31958, 0.30591, 0.28955, 0.28955, 0.26050, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000]

    bags, bag_sizes = bob.bag_maker('data/sdf/')
    bobs = bob.bag_of_bonds('data/sdf/butane.sdf', bags, bag_sizes)
    assert np.allclose(bobs, bobs_true, 1e-4) == True


if __name__ == "__main__":
    print("This is a test of the bag of bonds representation in chemreps to be evaluated with pytest")
