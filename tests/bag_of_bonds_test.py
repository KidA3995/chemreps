import numpy as np
import pytest as pt
from chemreps.bagger import BagMaker
from chemreps.bag_of_bonds import bag_of_bonds


def test_bag_of_bonds():
    bags_true = {'C': 7, 'CC': 21, 'CH': 42, 'H': 10, 'HH': 45, 'O': 2, 'OC': 14, 'OH': 12, 'OO': 1}
    bobs_true = np.array([36.84  , 36.84  , 36.84  , 36.84  ,  0.    ,  0.    ,  0.    ,
        0.    , 23.38  , 23.38  , 23.33  , 14.15  , 14.15  ,  9.195 ,
        0.    ,  0.    ,  0.    ,  0.    ,  0.    ,  0.    ,  0.    ,
        0.    ,  0.    ,  0.    ,  0.    ,  0.    ,  0.    ,  0.    ,
        0.    ,  0.    ,  5.492 ,  5.492 ,  5.492 ,  5.492 ,  5.492 ,
        5.492 ,  5.492 ,  5.492 ,  5.492 ,  5.492 ,  2.775 ,  2.775 ,
        2.775 ,  2.775 ,  2.762 ,  2.762 ,  2.762 ,  2.762 ,  2.76  ,
        2.76  ,  2.752 ,  2.752 ,  2.752 ,  2.752 ,  2.162 ,  2.162 ,
        2.162 ,  2.162 ,  2.145 ,  2.145 ,  2.145 ,  2.145 ,  1.717 ,
        1.717 ,  1.42  ,  1.42  ,  1.42  ,  1.42  ,  1.272 ,  1.272 ,
        0.    ,  0.    ,  0.    ,  0.5   ,  0.5   ,  0.5   ,  0.5   ,
        0.5   ,  0.5   ,  0.5   ,  0.5   ,  0.5   ,  0.5   ,  0.    ,
        0.567 ,  0.567 ,  0.565 ,  0.565 ,  0.565 ,  0.565 ,  0.5635,
        0.5635,  0.4016,  0.4016,  0.4016,  0.4016,  0.3982,  0.3982,
        0.3982,  0.3982,  0.3975,  0.3975,  0.387 ,  0.387 ,  0.387 ,
        0.387 ,  0.3254,  0.3254,  0.3254,  0.3254,  0.3254,  0.3254,
        0.3193,  0.3193,  0.3193,  0.3193,  0.265 ,  0.265 ,  0.265 ,
        0.2646,  0.2256,  0.2256,  0.2095,  0.2095,  0.2041,  0.2041,
        0.2041,  0.2041,  0.1781,  0.    ,  0.    ,  0.    ,  0.    ,
        0.    ,  0.    ,  0.    ,  0.    ,  0.    ,  0.    ,  0.    ,
        0.    ,  0.    ,  0.    ,  0.    ,  0.    ,  0.    ,  0.    ,
        0.    ,  0.    ,  0.    ,  0.    ,  0.    ,  0.    ,  0.    ,
        0.    ,  0.    ,  0.    ,  0.    ,  0.    ,  0.    ,  0.    ,
        0.    ,  0.    ], dtype=np.float16)
    bagger = BagMaker('BoB', 'data/sdf/')
    assert bagger.bag_sizes == bags_true

    bobs = bag_of_bonds('data/sdf/butane.sdf', bagger.bags, bagger.bag_sizes)
    assert np.allclose(bobs, bobs_true, 1e-4) == True


if __name__ == "__main__":
    print("This is a test of the bag of bonds representation in chemreps to be evaluated with pytest")
